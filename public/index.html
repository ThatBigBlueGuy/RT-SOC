<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>

  $(function () {
    var socket = io();
    var nextTurnSound = document.createElement('audio');
    nextTurnSound.setAttribute('src', '/sounds/Beep-SoundBible.mp3');



    $('form').submit(function(e){
      e.preventDefault(); // prevents page reloading
      if (this.name == 'send'){
        socket.emit('chat message', $('#m').val());
        $('#m').val('');
      } else if (this.name == 'start'){
        nextTurnSound.play();
        socket.emit('start', {turnPeriod : $('#turnPeriod').val(), turnPerDecay: $('#turnPerDecay').val() , minTurnPeriod: $('#minTurnPeriod').val(), seasonsOn: $('#seasonsOn').val(), seasonPeriod : $('#seasonPeriod').val()})
      } else if (this.name == 'stop'){
        socket.emit('stop', ''); 
      }  
      return false;
    });

    socket.on('chat message', (msg) => {
      $('#messages').append($('<li>').text(msg));
      $('.chat-messages-box').scrollTop($('.chat-messages-box')[0].scrollHeight);
    });

    socket.on('sm', (sm) => {
      $('#timeLeftInTurn').val(sm.timeLeftInTurn)
      $('#diceRoll').val(sm.diceRoll)
      if ($('#turnNumber').val() != sm.turnNumber){
        nextTurnSound.play();
      }
      $('#turnNumber').val(sm.turnNumber)
      $('#turnPeriod').val(sm.turnPeriod)
      $('#season').val(sm.season)
    });

    $(".open-button").click(function() {
      $("#myForm").css({"display":"block"});
    });

    $(".cancel").click(function() {
      $("#myForm").css({"display":"none"});
    });

    $("#myForm").keypress(function(event){
      var keycode = (event.keyCode ? event.keyCode : event.which)
      if (keycode == '13'){ // Enter key
        socket.emit('chat message', $('#m').val());
        $('#m').val('');
      }
    });

  });
</script>
<!doctype html>
<html>
  <head>
    <title>RT-SOC</title>
    <link rel="stylesheet" href="style.css"/>
  </head>
  <body>
    <button class="open-button">Chat</button>

    <div class="chat-popup" id="myForm">
      <div class="chat-messages-box">
        <ul id="messages"></ul>
      </div>
      
      <form action="" class="form-container" name="send"> 
        <textarea type="submit" id="m" placeholder="Type message.." name="msg" required></textarea>
        <button type="submit" class="btn">Send</button>
        <button id="btn-cancel" type="button" class="btn cancel">Close</button>
      </form>
    </div>

    <game>
      <section>
        <input id="turnPeriod" autocomplete="off" value=100 >Turn Period (s)</input>
        <input id="turnPerDecay" autocomplete="off" value=1 >Turn Period Decay (s) </input>
        <input id="minTurnPeriod" autocomplete="off" value=30 >Minimum Turn Period (s) </input>
        <input id="seasonsOn" autocomplete="off" value='TRUE' >Seasons On (TRUE/FALSE)</input>
        <input id="seasonPeriod" autocomplete="off" value=10 >Seasons Period (turns)</input>
      </section>
      <section>
        <label>Time Left In Turn (s)<output id="timeLeftInTurn" ></output></label>
        <label>Dice Roll<output id="diceRoll" ></output></label>
        <label>Turn Number<output id="turnNumber" ></output></label>
        <label>Turn Period (s)<output id="turnPeriod" > </output></label>
        <label>Season<output id="season" ></output></label>
      </section>
      <section>
        <form action="" name='start'>
          <button>START</button>
        </form>
      </section>
      <section>
        <form action="" name='stop'>
          <button>STOP</button>
        </form>
      </section>
    </game>
    <script>

    </script>
  </body>
</html>